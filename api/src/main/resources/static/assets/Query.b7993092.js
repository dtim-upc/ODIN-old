import{Q as x}from"./use-model-toggle.3d79aca0.js";import{Q as S,a as L}from"./format.47a278a4.js";import{g as $,o as y,c as B,v as t,s as a,B as w,ah as T,q as Q,y as _,D as F,i as A,A as I,z as q,aj as M,r as b,u as O,ag as R,aA as U,C as P,aB as z,an as W}from"./index.1dc04fa4.js";import{Q as V}from"./QExpansionItem.b73c8515.js";import{Q as H}from"./QScrollArea.11b26204.js";import{a as J,Q as K}from"./QCard.8b1340ac.js";import{Q as X}from"./QCardActions.0d259f99.js";import{b as Y}from"./QSelect.c81869a2.js";import{u as Z,Q as ee}from"./datasources.store.9808ef93.js";import{C as N}from"./ClosePopup.421ca59b.js";import{Q as te}from"./QTooltip.ed3efd61.js";import{Q as ae}from"./QTable.569fc909.js";import{_ as le}from"./Graph.bb4fcfec.js";import"./use-dark.de9a0581.js";import"./QSlideTransition.7a7f0646.js";import"./QSeparator.db748d79.js";import"./uid.42677368.js";import"./QResizeObserver.1445b353.js";import"./QScrollObserver.df4290b0.js";import"./scroll.a88fb3a5.js";import"./touch.70a9dd44.js";import"./use-key-composition.87cdc301.js";import"./focus-manager.32f8d49a.js";import"./use-prevent-scroll.ca3d1e41.js";import"./use-quasar.62a15c0a.js";function j(r){setTimeout(()=>{window.URL.revokeObjectURL(r.href)},1e4),r.remove()}function oe(r,n,d={}){const{mimeType:m,byteOrderMark:h,encoding:i}=typeof d=="string"?{mimeType:d}:d,c=i!==void 0?new TextEncoder(i).encode([n]):n,l=h!==void 0?[h,c]:[c],e=new Blob(l,{type:m||"application/octet-stream"}),u=document.createElement("a");u.href=window.URL.createObjectURL(e),u.setAttribute("download",r),typeof u.download=="undefined"&&u.setAttribute("target","_blank"),u.classList.add("hidden"),u.style.position="fixed",document.body.appendChild(u);try{return u.click(),j(u),!0}catch(v){return j(u),v}}const re={class:"q-pa-md"},ne={__name:"TableQueryResult",props:{no_shadow:{type:Boolean,default:!1},view:{type:String,default:"datasources"},columns:{type:Array},rows:{type:Array},enableExport:{type:Boolean,default:!0}},setup(r){const n=r,d="Query result",m=(i,c,l)=>{let e=c!==void 0?c(i,l):i;return e=e==null?"":String(e),e=e.split('"').join('""'),`"${e}"`};$(m);const h=()=>{const i=[n.columns.map(l=>m(l.label))].concat(n.rows.map(l=>n.columns.map(e=>m(typeof e.field=="function"?e.field(l):l[e.field===void 0?e.name:e.field],e.format,l)).join(","))).join(`\r
`);oe("table-export.csv",i,"text/csv")!==!0&&notify.negative("Browser denied file download.")};return(i,c)=>(y(),B("div",re,[t(ae,{rows:r.rows,columns:r.columns,"row-key":"name","no-data-label":"No result.","no-results-label":"The filter didn't uncover any results",class:q({"no-shadow":r.no_shadow})},{"top-left":a(()=>[w("div",{class:"q-table__title"},T(d))]),"top-right":a(l=>[r.enableExport?(y(),Q(_,{key:0,color:"primary","icon-right":"archive",label:"Export to csv","no-caps":"",onClick:h})):F("",!0),t(_,{flat:"",round:"",dense:"",icon:l.inFullscreen?"fullscreen_exit":"fullscreen",onClick:l.toggleFullscreen},{default:a(()=>[A((y(),Q(te,{disable:i.$q.platform.is.mobile},{default:a(()=>[I(T(l.inFullscreen?"Exit Fullscreen":"Toggle Fullscreen"),1)]),_:2},1032,["disable"])),[[N]])]),_:2},1032,["icon","onClick"])]),_:1},8,["rows","columns","class"])]))}},se=r=>({headers:{Authorization:`Bearer ${r}`}});var ie={queryGraph(r,n,d){return M.post("/query/"+n+"/graphical",r,se(d))}};const ue={class:"col-2 columnHeader"},ce=w("h5",null,"Query",-1),de={class:"col-10"},Le={__name:"Query",setup(r){b(!0);const n=Z(),d=O(),m=b(!1),h=W(),i=b(""),c=b("");let l="";const e=b(""),u=b([{name:"Name",required:!0,label:"Name",align:"center",field:"name",sortable:!0},{name:"Type",required:!0,label:"Type",align:"center",field:"type",sortable:!0},{name:"#Wrappers",label:"#Wrappers",align:"center",field:"wrappers",sortable:!0},{name:"View Metadata",label:"View Metadata",align:"center",field:"View Metadata",sortable:!1},{name:"View_Source_Graph",label:"View Source Graph",align:"center",field:"View Source Graph",sortable:!1},{name:"actions",label:"actions",align:"center",field:"actions",sortable:!1}]),v=b([]),D=(s,o)=>{const p=[];for(const g in s){var f=new Object;f.name=s[g],f.label=s[g],f.field=s[g],f.align="center",f.sortable=!0,p.push(f)}u.value=p;const k=[];for(const g in o)k.push(JSON.parse(o[g]));v.value=k,m.value=!0},E=s=>{e.value=s.id,i.value=s.graphicalSchema,c.value=s.id,l="source"},C=()=>{e.value="project",i.value=n.getGlobalSchema,c.value=n.project.id,l="global"},G=s=>{console.log("query fn.."),s.graphID=c.value,s.graphType=l,console.log("dd",s),ie.queryGraph(s,n.project.id,d.user.accessToken).then(o=>{console.log("query success",o),o.data==""&&h.positive("Query result is empty"),o.data&&o.data!=""&&D(o.data.columns,o.data.rows)}).catch(o=>{console.log("error query graph",o)})};return R(async()=>{await n.setProject(),C()}),(s,o)=>(y(),Q(ee,{class:"row items-stretch"},{default:a(()=>[w("div",ue,[t(H,{class:"fit"},{default:a(()=>[t(S,null,{default:a(()=>[t(L,null,{default:a(()=>[t(x,null,{default:a(()=>[ce]),_:1})]),_:1}),t(V,{label:"Global schema","expand-icon":"arrow_drop_down","default-opened":""},{default:a(()=>[t(S,{dense:""},{default:a(()=>[t(x,null,{default:a(()=>[t(_,{flat:"",padding:"xs",label:"project",class:q(["full-width",e.value=="project"?"activebg":""]),align:"left",onClick:o[0]||(o[0]=p=>C())},null,8,["class"])]),_:1})]),_:1})]),_:1}),t(V,{label:"Local schemata","expand-icon":"arrow_drop_down"},{default:a(()=>[t(S,{dense:""},{default:a(()=>[(y(!0),B(z,null,U(P(n).datasources,p=>(y(),Q(x,null,{default:a(()=>[t(_,{flat:"",padding:"xs",label:p.name,class:q(["full-width",e.value==p.id?"activebg":""]),align:"left",onClick:f=>E(p)},null,8,["label","class","onClick"])]),_:2},1024))),256))]),_:1})]),_:1})]),_:1})]),_:1})]),w("div",de,[t(le,{graphical:i.value,enableSelection:!0,enableQuery:!0,queryFunc:G},null,8,["graphical"])]),t(Y,{modelValue:m.value,"onUpdate:modelValue":o[1]||(o[1]=p=>m.value=p),"full-width":""},{default:a(()=>[t(J,null,{default:a(()=>[t(K,null,{default:a(()=>[t(ne,{columns:u.value,rows:v.value,no_shadow:!0},null,8,["columns","rows"])]),_:1}),t(X,{align:"right"},{default:a(()=>[A(t(_,{flat:"",label:"OK",color:"primary"},null,512),[[N]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Le as default};
