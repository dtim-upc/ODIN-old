import{Q as A}from"./use-model-toggle.6c9b3b17.js";import{Q as j,a as N}from"./QList.a7d2d4d7.js";import{Q as D}from"./QScrollArea.b3a0f22c.js";import{Q as E,a as F}from"./QCard.fada2e12.js";import{g as G,o as _,c as L,v as s,s as n,B as v,aF as q,q as w,y as Q,D as M,i as T,z as O,A as R,aq as $,r as p,u as I,ag as U,au as P}from"./index.d68f4a5a.js";import{Q as z}from"./QCardActions.a8303691.js";import{c as W}from"./QSelect.b26dbc07.js";import{u as H,Q as J}from"./datasources.store.11e61b1c.js";import{C as V}from"./ClosePopup.ec66148b.js";import{Q as K}from"./QTooltip.7e51ce49.js";import{Q as X}from"./QTable.10ad9361.js";import{_ as Y}from"./Graph.b4659d0f.js";import"./use-dark.cac0eb06.js";import"./QResizeObserver.483c420e.js";import"./QScrollObserver.478033f2.js";import"./touch.70a9dd44.js";import"./format.2a3572e1.js";import"./use-key-composition.b19a4bbf.js";import"./uid.42677368.js";import"./focus-manager.32f8d49a.js";import"./QMenu.6dc407a1.js";import"./use-prevent-scroll.8ee261ba.js";import"./QSeparator.a128976e.js";import"./use-quasar.0d998acc.js";function x(a){setTimeout(()=>{window.URL.revokeObjectURL(a.href)},1e4),a.remove()}function Z(a,r,d={}){const{mimeType:m,byteOrderMark:f,encoding:i}=typeof d=="string"?{mimeType:d}:d,c=i!==void 0?new TextEncoder(i).encode([r]):r,t=f!==void 0?[f,c]:[c],e=new Blob(t,{type:m||"application/octet-stream"}),l=document.createElement("a");l.href=window.URL.createObjectURL(e),l.setAttribute("download",a),typeof l.download=="undefined"&&l.setAttribute("target","_blank"),l.classList.add("hidden"),l.style.position="fixed",document.body.appendChild(l);try{return l.click(),x(l),!0}catch(b){return x(l),b}}const ee={class:"q-pa-md"},te={__name:"TableQueryResult",props:{no_shadow:{type:Boolean,default:!1},view:{type:String,default:"datasources"},columns:{type:Array},rows:{type:Array},enableExport:{type:Boolean,default:!0}},setup(a){const r=a,d="Query result",m=(i,c,t)=>{let e=c!==void 0?c(i,t):i;return e=e==null?"":String(e),e=e.split('"').join('""'),`"${e}"`};G(m);const f=()=>{const i=[r.columns.map(t=>m(t.label))].concat(r.rows.map(t=>r.columns.map(e=>m(typeof e.field=="function"?e.field(t):t[e.field===void 0?e.name:e.field],e.format,t)).join(","))).join(`\r
`);Z("table-export.csv",i,"text/csv")!==!0&&notify.negative("Browser denied file download.")};return(i,c)=>(_(),L("div",ee,[s(X,{rows:a.rows,columns:a.columns,"row-key":"name","no-data-label":"No result.","no-results-label":"The filter didn't uncover any results",class:R({"no-shadow":a.no_shadow})},{"top-left":n(()=>[v("div",{class:"q-table__title"},q(d))]),"top-right":n(t=>[a.enableExport?(_(),w(Q,{key:0,color:"primary","icon-right":"archive",label:"Export to csv","no-caps":"",onClick:f})):M("",!0),s(Q,{flat:"",round:"",dense:"",icon:t.inFullscreen?"fullscreen_exit":"fullscreen",onClick:t.toggleFullscreen},{default:n(()=>[T((_(),w(K,{disable:i.$q.platform.is.mobile},{default:n(()=>[O(q(t.inFullscreen?"Exit Fullscreen":"Toggle Fullscreen"),1)]),_:2},1032,["disable"])),[[V]])]),_:2},1032,["icon","onClick"])]),_:1},8,["rows","columns","class"])]))}},ae=a=>({headers:{Authorization:`Bearer ${a}`}});var oe={queryGraph(a,r,d){return $.post("/query/"+r+"/graphical",a,ae(d))}};const re={class:"col-2 columnHeader"},le=v("h5",null," Query",-1),se={class:"col-10"},Ae={__name:"Query",setup(a){p(!0);const r=H(),d=I(),m=p(!1),f=P(),i=p(""),c=p("");let t="";const e=p(""),l=p([{name:"Name",required:!0,label:"Name",align:"center",field:"name",sortable:!0},{name:"Type",required:!0,label:"Type",align:"center",field:"type",sortable:!0},{name:"#Wrappers",label:"#Wrappers",align:"center",field:"wrappers",sortable:!0},{name:"View Metadata",label:"View Metadata",align:"center",field:"View Metadata",sortable:!1},{name:"View_Source_Graph",label:"View Source Graph",align:"center",field:"View Source Graph",sortable:!1},{name:"actions",label:"actions",align:"center",field:"actions",sortable:!1}]),b=p([]),k=(u,o)=>{const g=[];for(const h in u){var y=new Object;y.name=u[h],y.label=u[h],y.field=u[h],y.align="center",y.sortable=!0,g.push(y)}l.value=g;const S=[];for(const h in o)S.push(JSON.parse(o[h]));b.value=S,m.value=!0},C=()=>{e.value="project",i.value=r.getGlobalSchema,c.value=r.project.id,t="global"},B=u=>{console.log("query fn.."),u.graphID=c.value,u.graphType=t,console.log("dd",u),oe.queryGraph(u,r.project.id,d.user.accessToken).then(o=>{console.log("query success",o),o.data==""&&f.positive("Query result is empty"),o.data&&o.data!=""&&k(o.data.columns,o.data.rows)}).catch(o=>{console.log("error query graph",o)})};return U(async()=>{await r.setProject(),C()}),(u,o)=>(_(),w(J,{class:"row items-stretch"},{default:n(()=>[v("div",re,[s(D,{class:"fit"},{default:n(()=>[s(j,null,{default:n(()=>[s(N,null,{default:n(()=>[s(A,null,{default:n(()=>[le]),_:1})]),_:1})]),_:1})]),_:1})]),v("div",se,[s(Y,{graphical:i.value,enableSelection:!0,enableQuery:!0,queryFunc:B},null,8,["graphical"])]),s(W,{modelValue:m.value,"onUpdate:modelValue":o[0]||(o[0]=g=>m.value=g),"full-width":""},{default:n(()=>[s(E,null,{default:n(()=>[s(F,null,{default:n(()=>[s(te,{columns:l.value,rows:b.value,no_shadow:!0},null,8,["columns","rows"])]),_:1}),s(z,{align:"right"},{default:n(()=>[T(s(Q,{flat:"",label:"OK",color:"primary"},null,512),[[V]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Ae as default};
