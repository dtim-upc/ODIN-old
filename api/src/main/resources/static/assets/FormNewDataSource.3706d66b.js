import{a as $,Q as Y}from"./QCard.821d0828.js";import{u as Z,Q as E}from"./QInput.01023d16.js";import{a as ee,b as te,c as ae}from"./QSelect.508df21f.js";import{r as Q,a as d,m as W,a5 as le,h as w,K as G,b as ne,R as ie,g as ue,as as oe,ah as se,ad as re,o as L,q as ce,s as I,v,x as de,c as fe,y as K,i as me,D as pe,C as ve,ax as ge,B as ye,au as be}from"./index.5d7be89b.js";import{u as he,d as Se,a as Fe,c as xe,e as Ve,b as Ce,f as M}from"./use-key-composition.af398085.js";import{h as we}from"./format.2a3572e1.js";import{Q as De}from"./QForm.1a5e5d45.js";import{C as _e}from"./ClosePopup.bf7361d0.js";import{a as ke}from"./datasources.store.646bd64b.js";function B(t,c,V,g){const u=[];return t.forEach(s=>{g(s)===!0?u.push(s):c.push({failedPropValidation:V,file:s})}),u}function A(t){t&&t.dataTransfer&&(t.dataTransfer.dropEffect="copy"),G(t)}const ze={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},Ne=["rejected"];function Ie({editable:t,dnd:c,getFileInput:V,addFilesToQueue:g}){const{props:u,emit:s,proxy:S}=W(),C=Q(null),F=d(()=>u.accept!==void 0?u.accept.split(",").map(e=>(e=e.trim(),e==="*"?"*/":(e.endsWith("/*")&&(e=e.slice(0,e.length-1)),e.toUpperCase()))):null),D=d(()=>parseInt(u.maxFiles,10)),_=d(()=>parseInt(u.maxTotalSize,10));function y(e){if(t.value)if(e!==Object(e)&&(e={target:null}),e.target!==null&&e.target.matches('input[type="file"]')===!0)e.clientX===0&&e.clientY===0&&le(e);else{const l=V();l&&l!==e.target&&l.click(e)}}function h(e){t.value&&e&&g(null,e)}function k(e,l,j,P){let n=Array.from(l||e.target.files);const p=[],x=()=>{p.length>0&&s("rejected",p)};if(u.accept!==void 0&&F.value.indexOf("*/")===-1&&(n=B(n,p,"accept",i=>F.value.some(r=>i.type.toUpperCase().startsWith(r)||i.name.toUpperCase().endsWith(r))),n.length===0))return x();if(u.maxFileSize!==void 0){const i=parseInt(u.maxFileSize,10);if(n=B(n,p,"max-file-size",r=>r.size<=i),n.length===0)return x()}if(u.multiple!==!0&&n.length>0&&(n=[n[0]]),n.forEach(i=>{i.__key=i.webkitRelativePath+i.lastModified+i.name+i.size}),P===!0){const i=j.map(r=>r.__key);n=B(n,p,"duplicate",r=>i.includes(r.__key)===!1)}if(n.length===0)return x();if(u.maxTotalSize!==void 0){let i=P===!0?j.reduce((r,O)=>r+O.size,0):0;if(n=B(n,p,"max-total-size",r=>(i+=r.size,i<=_.value)),n.length===0)return x()}if(typeof u.filter=="function"){const i=u.filter(n);n=B(n,p,"filter",r=>i.includes(r))}if(u.maxFiles!==void 0){let i=P===!0?j.length:0;if(n=B(n,p,"max-files",()=>(i++,i<=D.value)),n.length===0)return x()}if(x(),n.length>0)return n}function z(e){A(e),c.value!==!0&&(c.value=!0)}function o(e){G(e),e.relatedTarget!==C.value&&(c.value=!1)}function N(e){A(e);const l=e.dataTransfer.files;l.length>0&&g(null,l),c.value=!1}function f(e){if(c.value===!0)return w("div",{ref:C,class:`q-${e}__dnd absolute-full`,onDragenter:A,onDragover:A,onDragleave:o,onDrop:N})}return Object.assign(S,{pickFiles:y,addFiles:h}),{pickFiles:y,addFiles:h,onDragover:z,processFiles:k,getDndNode:f,maxFilesNumber:D,maxTotalSizeNumber:_}}var Be=ne({name:"QFile",inheritAttrs:!1,props:{...he,...Se,...ze,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...Fe,...Ne],setup(t,{slots:c,emit:V,attrs:g}){const{proxy:u}=W(),s=xe(),S=Q(null),C=Q(!1),F=Ve(t),{pickFiles:D,onDragover:_,onDragleave:y,processFiles:h,getDndNode:k}=Ie({editable:s.editable,dnd:C,getFileInput:U,addFilesToQueue:T}),z=Z(t),o=d(()=>Object(t.modelValue)===t.modelValue?"length"in t.modelValue?Array.from(t.modelValue):[t.modelValue]:[]),N=d(()=>M(o.value)),f=d(()=>o.value.map(a=>a.name).join(", ")),e=d(()=>we(o.value.reduce((a,m)=>a+m.size,0))),l=d(()=>({totalSize:e.value,filesNumber:o.value.length,maxFiles:t.maxFiles})),j=d(()=>({tabindex:-1,type:"file",title:"",accept:t.accept,capture:t.capture,name:F.value,...g,id:s.targetUid.value,disabled:s.editable.value!==!0})),P=d(()=>"q-file q-field--auto-height"+(C.value===!0?" q-file--dnd":"")),n=d(()=>t.multiple===!0&&t.append===!0);function p(a){const m=o.value.slice();m.splice(a,1),i(m)}function x(a){const m=o.value.findIndex(a);m>-1&&p(m)}function i(a){V("update:modelValue",t.multiple===!0?a:a[0])}function r(a){a.keyCode===13&&ie(a)}function O(a){(a.keyCode===13||a.keyCode===32)&&D(a)}function U(){return S.value}function T(a,m){const b=h(a,m,o.value,n.value),R=U();R!=null&&(R.value=""),b!==void 0&&((t.multiple===!0?t.modelValue&&b.every(X=>o.value.includes(X)):t.modelValue===b[0])||i(n.value===!0?o.value.concat(b):b))}function q(){return[w("input",{class:[t.inputClass,"q-file__filler"],style:t.inputStyle})]}function H(){if(c.file!==void 0)return o.value.length===0?q():o.value.map((m,b)=>c.file({index:b,file:m,ref:this}));if(c.selected!==void 0)return o.value.length===0?q():c.selected({files:o.value,ref:this});if(t.useChips===!0)return o.value.length===0?q():o.value.map((m,b)=>w(ee,{key:"file-"+b,removable:s.editable.value,dense:!0,textColor:t.color,tabindex:t.tabindex,onRemove:()=>{p(b)}},()=>w("span",{class:"ellipsis",textContent:m.name})));const a=t.displayValue!==void 0?t.displayValue:f.value;return a.length>0?[w("div",{class:t.inputClass,style:t.inputStyle,textContent:a})]:q()}function J(){const a={ref:S,...j.value,...z.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:T};return t.multiple===!0&&(a.multiple=!0),w("input",a)}return Object.assign(s,{fieldClass:P,emitValue:i,hasValue:N,inputRef:S,innerValue:o,floatingLabel:d(()=>N.value===!0||M(t.displayValue)),computedCounter:d(()=>{if(t.counterLabel!==void 0)return t.counterLabel(l.value);const a=t.maxFiles;return`${o.value.length}${a!==void 0?" / "+a:""} (${e.value})`}),getControlChild:()=>k("file"),getControl:()=>{const a={ref:s.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:t.tabindex};return s.editable.value===!0&&Object.assign(a,{onDragover:_,onDragleave:y,onKeydown:r,onKeyup:O}),w("div",a,[J()].concat(H()))}}),Object.assign(u,{removeAtIndex:p,removeFile:x,getNativeElement:()=>S.value}),Ce(s)}});const Qe=ye("div",{class:"text-h6"},"Create new data source",-1),je={key:0},Le={__name:"FormNewDataSource",props:{show:{type:Boolean,default:!1,required:!0},showFormButtons:{type:Boolean,default:!0},afterSubmitShowGraph:{type:Boolean,default:!0}},emits:["update:show"],setup(t,{expose:c,emit:V}){const g=t,u=d({get(){return g.show},set(f){V("update:show",f)}}),s=ke();ue(()=>{s.init()});const S=oe(),C=se(),F=Q(null),D=be();c({form:F});const _=["SQLDatabase","Upload file"],y=re({name:"",description:""}),h=Q(null),k=Q("Upload file"),z=()=>{h.value=null},o=()=>{var f=new FormData;f.append("file",h.value),f.append("dataSource",new Blob([JSON.stringify(y)],{type:"application/json"})),s.addDataSource(S.params.id,f,N)},N=f=>{console.log("success callback"),D.positive(`Data Source ${f.name} successfully uploaded`),z(),F.value.resetValidation(),u.value=!1,s.addSelectedDatasource(f),g.afterSubmitShowGraph&&C.push({name:"dsIntegration"})};return(f,e)=>(L(),ce(ae,{modelValue:ve(u),"onUpdate:modelValue":e[5]||(e[5]=l=>ge(u)?u.value=l:null),onHide:e[6]||(e[6]=l=>g.show=!1)},{default:I(()=>[v(Y,{style:{width:"400px","max-width":"80vw"}},{default:I(()=>[v($,null,{default:I(()=>[Qe]),_:1}),v($,null,{default:I(()=>[v(De,{ref_key:"form",ref:F,onSubmit:o,onReset:z,class:"q-gutter-md"},{default:I(()=>[v(E,{filled:"",modelValue:y.name,"onUpdate:modelValue":e[0]||(e[0]=l=>y.name=l),label:"Introduce a data source name","lazy-rules":"",rules:[l=>l&&l.length>0||"Please type a name"]},null,8,["modelValue","rules"]),v(te,{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=l=>k.value=l),options:_,label:"Type",class:"q-mt-none"},null,8,["modelValue"]),v(E,{modelValue:y.description,"onUpdate:modelValue":e[2]||(e[2]=l=>y.description=l),filled:"",autogrow:"",label:"Description (Optional)"},null,8,["modelValue"]),v(Be,{ref:"fileds",outlined:"",modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=l=>h.value=l),"auto-expand":"",label:"Select the file you would like to import.",headers:{"content-type":"multipart/form-data"},accept:".csv, application/json","max-files":1,"lazy-rules":"",rules:[l=>l&&l.name!==""||"Please upload a file"]},{prepend:I(()=>[v(de,{name:"attach_file",onClick:e[3]||(e[3]=l=>{this.$refs.fileds.pickFiles()})})]),_:1},8,["modelValue","rules"]),t.showFormButtons?(L(),fe("div",je,[v(K,{label:"Submit",type:"submit",color:"primary"}),me(v(K,{label:"Cancel",type:"reset",color:"primary",flat:"",class:"q-ml-sm"},null,512),[[_e]])])):pe("",!0)]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};export{Le as _};
