import{u as G,b as Z,c as ee,d as te,e as le,f as ae,g as ne,h as $,Q as E,i as L,a as ie}from"./QInput.3668a96b.js";import{Q as ue,a as oe,C as se,b as re}from"./ClosePopup.06890773.js";import{r as Q,a as m,m as K,W as ce,h as w,I as H,b as de,V as fe,g as me,ai as pe,ap as ve,a4 as ge,o as W,q as ye,s as N,v,x as be,c as he,y as M,i as Fe,D as Se,aq as Ve,B as xe,ak as Ce}from"./index.1c9f1618.js";import{h as we}from"./format.31819496.js";import{Q as De}from"./QForm.66a341cf.js";import{u as ke}from"./datasources.store.2c9687c1.js";function I(t,c,D,S){const i=[];return t.forEach(s=>{S(s)===!0?i.push(s):c.push({failedPropValidation:D,file:s})}),i}function A(t){t&&t.dataTransfer&&(t.dataTransfer.dropEffect="copy"),H(t)}const ze={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},_e=["rejected"];function Ne({editable:t,dnd:c,getFileInput:D,addFilesToQueue:S}){const{props:i,emit:s,proxy:V}=K(),h=Q(null),k=m(()=>i.accept!==void 0?i.accept.split(",").map(e=>(e=e.trim(),e==="*"?"*/":(e.endsWith("/*")&&(e=e.slice(0,e.length-1)),e.toUpperCase()))):null),z=m(()=>parseInt(i.maxFiles,10)),g=m(()=>parseInt(i.maxTotalSize,10));function F(e){if(t.value)if(e!==Object(e)&&(e={target:null}),e.target!==null&&e.target.matches('input[type="file"]')===!0)e.clientX===0&&e.clientY===0&&ce(e);else{const y=D();y&&y!==e.target&&y.click(e)}}function C(e){t.value&&e&&S(null,e)}function _(e,y,B,P){let a=Array.from(y||e.target.files);const p=[],x=()=>{p.length>0&&s("rejected",p)};if(i.accept!==void 0&&k.value.indexOf("*/")===-1&&(a=I(a,p,"accept",n=>k.value.some(r=>n.type.toUpperCase().startsWith(r)||n.name.toUpperCase().endsWith(r))),a.length===0))return x();if(i.maxFileSize!==void 0){const n=parseInt(i.maxFileSize,10);if(a=I(a,p,"max-file-size",r=>r.size<=n),a.length===0)return x()}if(i.multiple!==!0&&a.length>0&&(a=[a[0]]),a.forEach(n=>{n.__key=n.webkitRelativePath+n.lastModified+n.name+n.size}),P===!0){const n=B.map(r=>r.__key);a=I(a,p,"duplicate",r=>n.includes(r.__key)===!1)}if(a.length===0)return x();if(i.maxTotalSize!==void 0){let n=P===!0?B.reduce((r,O)=>r+O.size,0):0;if(a=I(a,p,"max-total-size",r=>(n+=r.size,n<=g.value)),a.length===0)return x()}if(typeof i.filter=="function"){const n=i.filter(a);a=I(a,p,"filter",r=>n.includes(r))}if(i.maxFiles!==void 0){let n=P===!0?B.length:0;if(a=I(a,p,"max-files",()=>(n++,n<=z.value)),a.length===0)return x()}if(x(),a.length>0)return a}function j(e){A(e),c.value!==!0&&(c.value=!0)}function u(e){H(e),e.relatedTarget!==h.value&&(c.value=!1)}function d(e){A(e);const y=e.dataTransfer.files;y.length>0&&S(null,y),c.value=!1}function o(e){if(c.value===!0)return w("div",{ref:h,class:`q-${e}__dnd absolute-full`,onDragenter:A,onDragover:A,onDragleave:u,onDrop:d})}return Object.assign(V,{pickFiles:F,addFiles:C}),{pickFiles:F,addFiles:C,onDragover:j,processFiles:_,getDndNode:o,maxFilesNumber:z,maxTotalSizeNumber:g}}var Ie=de({name:"QFile",inheritAttrs:!1,props:{...G,...Z,...ze,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...ee,..._e],setup(t,{slots:c,emit:D,attrs:S}){const{proxy:i}=K(),s=te(),V=Q(null),h=Q(!1),k=le(t),{pickFiles:z,onDragover:g,onDragleave:F,processFiles:C,getDndNode:_}=Ne({editable:s.editable,dnd:h,getFileInput:R,addFilesToQueue:T}),j=ae(t),u=m(()=>Object(t.modelValue)===t.modelValue?"length"in t.modelValue?Array.from(t.modelValue):[t.modelValue]:[]),d=m(()=>$(u.value)),o=m(()=>u.value.map(l=>l.name).join(", ")),e=m(()=>we(u.value.reduce((l,f)=>l+f.size,0))),y=m(()=>({totalSize:e.value,filesNumber:u.value.length,maxFiles:t.maxFiles})),B=m(()=>({tabindex:-1,type:"file",title:"",accept:t.accept,capture:t.capture,name:k.value,...S,id:s.targetUid.value,disabled:s.editable.value!==!0})),P=m(()=>"q-file q-field--auto-height"+(h.value===!0?" q-file--dnd":"")),a=m(()=>t.multiple===!0&&t.append===!0);function p(l){const f=u.value.slice();f.splice(l,1),n(f)}function x(l){const f=u.value.findIndex(l);f>-1&&p(f)}function n(l){D("update:modelValue",t.multiple===!0?l:l[0])}function r(l){l.keyCode===13&&fe(l)}function O(l){(l.keyCode===13||l.keyCode===32)&&z(l)}function R(){return V.value}function T(l,f){const b=C(l,f,u.value,a.value),U=R();U!=null&&(U.value=""),b!==void 0&&((t.multiple===!0?t.modelValue&&b.every(Y=>u.value.includes(Y)):t.modelValue===b[0])||n(a.value===!0?u.value.concat(b):b))}function q(){return[w("input",{class:[t.inputClass,"q-file__filler"],style:t.inputStyle})]}function J(){if(c.file!==void 0)return u.value.length===0?q():u.value.map((f,b)=>c.file({index:b,file:f,ref:this}));if(c.selected!==void 0)return u.value.length===0?q():c.selected({files:u.value,ref:this});if(t.useChips===!0)return u.value.length===0?q():u.value.map((f,b)=>w(ue,{key:"file-"+b,removable:s.editable.value,dense:!0,textColor:t.color,tabindex:t.tabindex,onRemove:()=>{p(b)}},()=>w("span",{class:"ellipsis",textContent:f.name})));const l=t.displayValue!==void 0?t.displayValue:o.value;return l.length>0?[w("div",{class:t.inputClass,style:t.inputStyle,textContent:l})]:q()}function X(){const l={ref:V,...B.value,...j.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:T};return t.multiple===!0&&(l.multiple=!0),w("input",l)}return Object.assign(s,{fieldClass:P,emitValue:n,hasValue:d,inputRef:V,innerValue:u,floatingLabel:m(()=>d.value===!0||$(t.displayValue)),computedCounter:m(()=>{if(t.counterLabel!==void 0)return t.counterLabel(y.value);const l=t.maxFiles;return`${u.value.length}${l!==void 0?" / "+l:""} (${e.value})`}),getControlChild:()=>_("file"),getControl:()=>{const l={ref:s.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:t.tabindex};return s.editable.value===!0&&Object.assign(l,{onDragover:g,onDragleave:F,onKeydown:r,onKeyup:O}),w("div",l,[X()].concat(J()))}}),Object.assign(i,{removeAtIndex:p,removeFile:x,getNativeElement:()=>V.value}),ne(s)}});const Qe=xe("div",{class:"text-h6"},"Create new data source",-1),je={key:0},Re={__name:"FormNewDataSource",props:{show:{type:Boolean,default:!1},showFormButtons:{type:Boolean,default:!0}},emits:["update:show"],setup(t,{expose:c,emit:D}){const S=t,i=ke();me(()=>{i.init()});const s=pe(),V=ve(),h=Q(null),k=Ce();c({form:h});const z=["SQLDatabase","Upload file"],g=ge({name:"",description:""}),F=Q(null),C=Q("Upload file"),_=()=>{F.value=null},j=()=>{var d=new FormData;d.append("file",F.value),d.append("dataSource",new Blob([JSON.stringify(g)],{type:"application/json"})),i.addDataSource(s.params.id,d,u)},u=d=>{console.log("success callback"),k.positive(`Data Source ${d.name} successfully uploaded`),_(),h.value.resetValidation(),i.addSelectedDatasource(d),V.push({name:"dsIntegration"})};return(d,o)=>(W(),ye(re,{modelValue:t.show,"onUpdate:modelValue":o[5]||(o[5]=e=>Ve(show)?show.value=e:null),onHide:o[6]||(o[6]=e=>d.$emit("update:show",S.show))},{default:N(()=>[v(ie,{style:{width:"400px","max-width":"80vw"}},{default:N(()=>[v(E,null,{default:N(()=>[Qe]),_:1}),v(E,null,{default:N(()=>[v(De,{ref_key:"form",ref:h,onSubmit:j,onReset:_,class:"q-gutter-md"},{default:N(()=>[v(L,{filled:"",modelValue:g.name,"onUpdate:modelValue":o[0]||(o[0]=e=>g.name=e),label:"Introduce a data source name","lazy-rules":"",rules:[e=>e&&e.length>0||"Please type a name"]},null,8,["modelValue","rules"]),v(oe,{modelValue:C.value,"onUpdate:modelValue":o[1]||(o[1]=e=>C.value=e),options:z,label:"Type",class:"q-mt-none"},null,8,["modelValue"]),v(L,{modelValue:g.description,"onUpdate:modelValue":o[2]||(o[2]=e=>g.description=e),filled:"",autogrow:"",label:"Description (Optional)"},null,8,["modelValue"]),v(Ie,{ref:"fileds",outlined:"",modelValue:F.value,"onUpdate:modelValue":o[4]||(o[4]=e=>F.value=e),"auto-expand":"",label:"Select the file you would like to import.",headers:{"content-type":"multipart/form-data"},accept:".csv, application/json","max-files":1,"lazy-rules":"",rules:[e=>e&&e.name!==""||"Please upload a file"]},{prepend:N(()=>[v(be,{name:"attach_file",onClick:o[3]||(o[3]=e=>{this.$refs.fileds.pickFiles()})})]),_:1},8,["modelValue","rules"]),t.showFormButtons?(W(),he("div",je,[v(M,{label:"Submit",type:"submit",color:"primary"}),Fe(v(M,{label:"Cancel",type:"reset",color:"primary",flat:"",class:"q-ml-sm"},null,512),[[se]])])):Se("",!0)]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};export{Re as _};
